smallInput = `p=0,4 v=3,-3
p=6,3 v=-1,-3
p=10,3 v=-1,2
p=2,0 v=2,-1
p=0,0 v=1,3
p=3,0 v=-2,-2
p=7,6 v=-1,-3
p=3,0 v=-1,-2
p=9,3 v=2,3
p=7,3 v=-1,2
p=2,4 v=2,-3
p=9,5 v=-3,-3`;

smallGridSize = [11, 7];

bigGridSize = [101, 103];


parseRows = inp => inp.split(`\n`).map(x => parseRow(x));
parseRow = inp => {
    const [posInp, velInp] = inp.split(` `).map(x => x.slice(2));
    const pos = posInp.split(',').map(x => Number(x));
    const vel = velInp.split(',').map(x => Number(x));

    return [pos, vel];
};

const unparse = (unparsed) => {
    return unparsed.map(x => x.map(c => c ? c : '.').join(``)).join(`\n`);
}

stepRobot = (robot, maxX, maxY) => {
    const [[px, py], [vx, vy]] = robot;

    const newPx = (px + maxX + vx) % maxX;
    const newPy = (py + maxY + vy) % maxY;

    return [[newPx, newPy], [vx, vy]]
};

getGrid = (robots, gridSize) => {
    let grid = new Array(gridSize[1]);
    grid.fill([])
    grid = grid.map(x => new Array(gridSize[0]))
    grid = grid.map(x => x.fill(0))
    // console.log('blank', unparsed);
    // console.log('blank', unparsed);
    robots.forEach((robot, ri) => {
        // console.log(ri, robot);
        // console.log(unparsed.map(x => x.join(``)).join(`\n`));
        const [[px, py], [vx, vy]] = robot;
        grid[py][px] += 1;
    });

    return grid
}

getSafety = (grid, gridSize) => {

    const xmid = Math.floor(gridSize[0] / 2)
    const ymid = Math.floor(gridSize[1] / 2)

    // console.log(xmid,ymid)

    let q1 = 0;
    let q2 = 0;
    let q3 = 0;
    let q4 = 0;

    grid.forEach((y, yi) => {
        y.forEach((cell, xi) => {

            if (yi < ymid) {
                if (xi < xmid) {
                    q1 += cell;
                } else if (xi > xmid) {
                    q2 += cell;
                }
            } else if (yi > ymid) {
                if (xi < xmid) {
                    q3 += cell;
                } else if (xi > xmid) {
                    q4 += cell;

                }
            }

        })
    })
    // console.log('quads', q1, q2, q3, q4)
    return q1 * q2 * q3 * q4


}


final = (inp, size, steps) => {
    const robots = parseRows(inp);
    console.log('robots', robots);
    console.log(unparse(getGrid(robots, size)));

    const afterNSeconds = robots.map(r => {
        let current = r;
        for (let i = 0; i < steps; i++) {
            current = stepRobot(current, size[0], size[1]);
            console.log('step', i + 1, current)
            console.log(unparse(getGrid([current], size)))
        }
        return current;
    })
    console.log('robots+', afterNSeconds);
    const grid = getGrid(afterNSeconds, size)
    console.log(unparse(grid));
    return getSafety(grid, size);
}


// Part 2, there's a tree somewhere,
// setting size to something big and logging out the map at each step;
final2 = (inp, size, steps) => {
    const robots = parseRows(inp);
    console.log('robots', robots);
    console.log(unparse(getGrid(robots, size)));

    let current = robots;
    let grid;
    for (let i = 0; i < steps; i++) {
        current = current.map(r => stepRobot(r, size[0], size[1]));

        grid = getGrid(current, size);

        // don't know what the tree looks like 
        // hopefully that means no overlapping robots so I can reduce then number I have to check
        if (grid.flat().filter(x => x == 1).length == 500) {
            console.log('step', i+1);
            console.log('robots+', current);
            console.log(unparse(grid));
        }
    }

    console.log('robots+', current);
    console.log(unparse(grid));

    return getSafety(grid, size);
}

// lucky it worked out right. Did not expect this to be what it looked like at all;

const tree = 
`....................................1.......................................1........................
.................................................................................................1...
..............................1..1.....................1..........1..................................
.................................1...................................................................
.........1................................1........................................................1.
....................1................................................................................
.........................................1.....................................................1.....
..................1..............1..................................1................................
......................................1...................................1..........................
...................1............1....................................................................
...............................................................1.......................1.............
.....................................................................................................
................................1.............1......................................................
..1..................................................................................................
......................................................1..............................................
.......................................................................................1...1.........
.........1......................................................1....................................
.....................................................................................................
..................1..................1..................................1............................
.....................................................................................................
........................1......................................................................1.....
...................................1.........1..............1..........................1.............
..........1.....1.......................1............................................................
...............................................1.....................................................
....................................1................................................................
...........................................................1.........................................
.................................1...................................................................
...................1......................1....................................................1.....
.......1.............................................................................................
...................................1.....................................1...........................
.....................................................................................................
.....................................................................................................
.....................................................................................................
....11................................................1.........................1.....1.1............
......1..............................................................................................
..1...............1...........................................1......................................
.....................................................................................................
.....1.............................................................................1.................
..................1............................1111111111111111111111111111111.......................
...............................................1.............................1.......................
...............................................1.............................1.....1....1..1.........
.................................1.............1.............................1.........1.............
........................1......................1.............................1.......................
...............................................1..............1..............1.......................
...............................................1.............111.............1..........1............
..1............................................1............11111............1.......................
..............................1................1...........1111111...........1.......................
...............................................1..........111111111..........1.......................
...............................................1............11111............1.......................
...............................................1...........1111111...........1.......................
...................................1...........1..........111111111..........1.....1.................
............1..........................1.......1.........11111111111.........1.1.....................
...............................................1........1111111111111........1.......................
...............................................1..........111111111..........1.......................
...............................................1.........11111111111.........1.................1.....
...............................................1........1111111111111........1.......................
.........................1......1..............1.......111111111111111.......1.......................
...............................................1......11111111111111111......1.......1............1..
.....1.........................................1........1111111111111........1...........1...........
..................1............1...............1.......111111111111111.......1................1......
...............................................1......11111111111111111......1.......................
...............................................1.....1111111111111111111.....1.......................
...............................................1....111111111111111111111....1.......................
........1.................................1....1.............111.............1.......................
...............................................1.............111.............1.......................
..1............................................1.............111.............1.......................
........1.............1........................1.............................1.......................
..........................1....................1.............................1........1..............
........................................1......1.............................1.......................
...............................................1.............................1.......................
.............1.................................1111111111111111111111111111111.......................
...............................................................................1....1...1........1...
...................................................................................................1.
1................................................................................................1...
............1...................................................1....................................
..............................................................................1............1.........
....................................1...........................1...........1........................
................................................1.......1.....1..1...................................
....................................................................1.......1........................
.....................................................................................................
.....................................................................................................
1................................................................................1...................
...........................1..........1...................................................1..........
..........................................1..........................................................
................................................................................1....................
.................................................1...................................................
............1............................................1...........................................
.........................................................1...........................................
1....................................................................................................
...1.................................................................................................
...............................................................................................1.....
................1...............1....................................................................
.........1..........1................................................................................
.................................1.............1.....................................................
.....................................................................................................
..........................................1......................1...................................
...........................................1................1........................................
.....................................................................................................
...........................................1.........................................................
.....................................................................................................
....................................................................................................1
.....................................................................................................
.............................1................................................1......................`